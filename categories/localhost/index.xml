<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Localhost on 127.0.0.1</title>
    <link>http://127001.me/categories/localhost/</link>
    <description>Recent content in Localhost on 127.0.0.1</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 06 Jan 2016 01:51:40 +0100</lastBuildDate>
    <atom:link href="http://127001.me/categories/localhost/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Turning Synology NAS into a geeky media server</title>
      <link>http://127001.me/post/synology/mediaserver-p1/</link>
      <pubDate>Wed, 06 Jan 2016 01:51:40 +0100</pubDate>
      
      <guid>http://127001.me/post/synology/mediaserver-p1/</guid>
      <description>

&lt;p&gt;I&amp;rsquo;m not a huge fan of Synology. I bought my DS214 by friend&amp;rsquo;s recommendation and became frustrated with it right after
the purchase. Bundled software is limited and buggy, it feels like the worst Windows™®-like experience ever. Many people
find Synology products great. But for me it just doesn&amp;rsquo;t work well because it forces its usecases on me instead of being
a helpful tool for my own very specific use cases.&lt;/p&gt;

&lt;p&gt;Anyway, I wasn&amp;rsquo;t willing to lose money on reselling my NAS, so I decided to get as much as possible from it.&lt;/p&gt;

&lt;p&gt;So currently with my DS214Play I can:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Play virtually any sound via connected USB sound card.&lt;/li&gt;
&lt;li&gt;Particularly, I can play my huge collection of high-resolution music in various formats (with replaygain tags
respected). All that thanks to &lt;em&gt;mpd&lt;/em&gt;, which I can control from any decent phone, web-browser or even smart-watch and
scrobble all statistics to Last.fm.&lt;/li&gt;
&lt;li&gt;Stream sound from my laptop via &lt;em&gt;PulseAudio&lt;/em&gt;, while watching videos on YouTube or movies.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In this and few next posts I&amp;rsquo;m going to tell, what I have done to get all this.&lt;/p&gt;

&lt;p&gt;Although everything here have been tried on DS214Play it should also work on any other x86-based (or theoretically, even
some ARM-based) Synology product.&lt;/p&gt;

&lt;p&gt;I do not expect anything bad, but, just in case, standard disclaimer: &lt;strong&gt;everything described here may contain mistakes
and inaccuracies, cause data loss or even damage to your hardware.&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&#34;setup-debian-chroot&#34;&gt;Setup Debian Chroot&lt;/h1&gt;

&lt;p&gt;Thanks to &lt;a href=&#34;https://synocommunity.com&#34;&gt;SynoCommunity project&lt;/a&gt; it is possible to get access to thousands of applications
from Debian repositories by installing &lt;a href=&#34;https://synocommunity.com/package/debian-chroot&#34;&gt;Debian Chroot&lt;/a&gt;. Unlike optware
solutions, all packages are relatively fresh, easy to install, and more likely to work without issues.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Add SynoCommunity repo following &lt;a href=&#34;https://synocommunity.com/#easy-install&#34;&gt;official guide&lt;/a&gt;. Do not forget to set
Trust level to &lt;em&gt;Synology Inc. and trusted publishers&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Install &lt;a href=&#34;https://synocommunity.com/package/debian-chroot&#34;&gt;Debian Chroot&lt;/a&gt; package&lt;/li&gt;
&lt;li&gt;Start this package from &lt;em&gt;Package Center&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;configure-debian-chroot&#34;&gt;Configure Debian chroot&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;SSH to NAS as &lt;em&gt;root&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Chroot to Debian
&lt;code class=&#34;hljs&#34;&gt;
/var/packages/debian-chroot/scripts/start-stop-status chroot
&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Update package index and install locales to remove pesky warning about missing locales&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# apt-get update
# apt-get install locales-all
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Install alsa utils as we&amp;rsquo;ll require them later&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# apt-get install alsa-utils
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Exit to return back to NAS terminal (or create another SSH session)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# exit
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;share-media-files-to-debian-chroot&#34;&gt;Share media files to Debian chroot&lt;/h2&gt;

&lt;p&gt;By default Debian Chroot won&amp;rsquo;t get access to files stored on NAS (that&amp;rsquo;s the idea of chroot). We have to mount
explicitly those directories, we want to expose.&lt;/p&gt;

&lt;p&gt;Fron NAS terminal (not Debian Chroot, exit from it or create another SSH session to NAS):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mount -o bind /path/to/dir/on/nas /var/packages/debian-chroot/target/var/chroottarget/path/to/dir/in/chroot
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I created a script under &lt;code&gt;/usr/local/etc/rc.d/&lt;/code&gt; to do that mounting automatically on startup. The script must be named
&lt;code&gt;S[00-99]whatever.sh&lt;/code&gt; to be picked up by DSM init framework, where &lt;code&gt;[00-99]&lt;/code&gt; determines order of execution. Mine is
named &lt;code&gt;S02chrootmount.sh&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/sh

. /etc.defaults/rc.subr

CHROOTDIR=/var/packages/debian-chroot/target/var/chroottarget/media
MEDIADIR=/volume1/media

case $1 in
        start)
                mount -o bind $MEDIADIR $CHROOTDIR
        ;;
        stop)
                umount $CHROOTDIR
        ;;
        restart)
                $0 stop
                sleep 1
                $0 start
        ;;
        *)
                echo &amp;quot;Usage: $0 start|stop|restart&amp;quot;
        ;;
esac
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To expose directory to chroot then, do&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/usr/local/etc/rc.d/S02chrootmount.sh start
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After doing that, we can chroot to Debian again and check that mount worked as expected (&lt;code&gt;/media&lt;/code&gt; in chroot should
corresponds to &lt;code&gt;/volume1/media&lt;/code&gt; on NAS for my case).&lt;/p&gt;

&lt;h1 id=&#34;setup-sound-card&#34;&gt;Setup sound card&lt;/h1&gt;

&lt;p&gt;Obviously, sound card should be supported in Linux. I own &lt;em&gt;Audinst USB HUD mini&lt;/em&gt; and it&amp;rsquo;s a real plug-n-play. I just
plug it in, and if alsa is set up, it just works. For what it&amp;rsquo;s worth, I&amp;rsquo;m satisfied with the device, it sounds not as
good as my beloved ESI Juli@, but still it is good for its price.&lt;/p&gt;

&lt;h2 id=&#34;loading-kernel-modules&#34;&gt;Loading kernel modules&lt;/h2&gt;

&lt;p&gt;For sound card to work we need to install required kernel modules in host system (not in Debian Chroot). By default
those are loaded by &lt;em&gt;AudioStation&lt;/em&gt; application. I analyzed its scripts, and came up with the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/sh

. /etc.defaults/rc.subr

KERNELMODULE=&amp;quot;soundcore snd-page-alloc snd snd-seq-device snd-rawmidi snd-usbmidi-lib snd-usb-lib snd-hwdep snd-timer snd-pcm snd-usb-audio snd-mixer-oss snd-pcm-oss&amp;quot;
COMPATMODULE=&amp;quot;snd-usb-hiface&amp;quot;

case $1 in
        start)
                SYNOLoadModules $KERNELMODULE
                SYNOLoadModules $COMPATMODULE
        ;;
        stop)
                SYNOUnloadModules $COMPATMODULE
                SYNOUnloadModules $KERNELMODULE
        ;;
        restart)
                $0 stop
                sleep 1
                $0 start
        ;;
        *)
                echo &amp;quot;Usage: $0 start|stop|restart&amp;quot;
        ;;
esac
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This will load exactly the modules, that are loaded by &lt;em&gt;AudioStation&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;To do that automatically on NAS startup I saved the script as &lt;code&gt;/usr/local/etc/rc.d/S01audiod.sh&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Load modules without reboot:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/usr/local/etc/rc.d/S01audiod.sh start
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now if we chroot to Debian again and run &lt;code&gt;alsamixer&lt;/code&gt;, we should see usual mixer interface for connected soundcard.&lt;/p&gt;

&lt;p&gt;Basically that&amp;rsquo;s it. For more experienced users it shouldn&amp;rsquo;t be hard to setup mpd or PulseAudio on Debian. Anyway, I&amp;rsquo;ll
try to cover that in following posts for those, who are not well familiar with the topic.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Listen tracks from youtube in mpd</title>
      <link>http://127001.me/post/youtube-in-mpd/</link>
      <pubDate>Fri, 13 Sep 2013 14:18:07 +0300</pubDate>
      
      <guid>http://127001.me/post/youtube-in-mpd/</guid>
      <description>&lt;p&gt;You&amp;rsquo;ll need&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;mpd with &lt;code&gt;curl&lt;/code&gt; support&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://rg3.github.io/youtube-dl/&#34;&gt;youtube-dl&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Suppose, you want to listen to some &lt;a href=&#34;http://www.youtube.com/watch?v=HS5fHWmzqIg&#34;&gt;vocal trance&lt;/a&gt; on youtube.&lt;/p&gt;

&lt;p&gt;Use &lt;code&gt;youtube-dl&lt;/code&gt; to determine what formats are available&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;$ youtube-dl -f http://www.youtube.com/watch?v=HS5fHWmzqIg
[youtube] Setting language
[youtube] HS5fHWmzqIg: Downloading video webpage
[youtube] HS5fHWmzqIg: Downloading video info webpage
[youtube] HS5fHWmzqIg: Extracting video information
Available formats:
22      :       mp4     [720x1280]
18      :       mp4     [360x640]
43      :       webm    [360x640]
5       :       flv     [240x400]
36      :       3gp     [240x320]
17      :       3gp     [144x176]
136     :       mp4     [720p] (DASH Video)
135     :       mp4     [480p] (DASH Video)
134     :       mp4     [360p] (DASH Video)
133     :       mp4     [240p] (DASH Video)
160     :       mp4     [192p] (DASH Video)
141     :       m4a     [256k] (DASH Audio)
172     :       webm    [256k] (DASH Audio)
140     :       m4a     [128k] (DASH Audio)
171     :       webm    [128k] (DASH Audio)
139     :       m4a     [48k] (DASH Audio)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;There are 5 audio formats for this video. &lt;strong&gt;141&lt;/strong&gt;&lt;sup&gt;th&lt;/sup&gt; has highest bitrate. So all we have to do, is to get real URL for this format and feed it to mpd&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ mpc add `youtube-dl -f141 -g http://www.youtube.com/watch?v=HS5fHWmzqIg`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That&amp;rsquo;s all, track from youtube is already in your mpd playlist. Enjoy!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>